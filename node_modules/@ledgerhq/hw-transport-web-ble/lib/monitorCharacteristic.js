"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.monitorCharacteristic = undefined;

var _rxjs = require("rxjs");

var _logs = require("@ledgerhq/logs");

var monitorCharacteristic = exports.monitorCharacteristic = function monitorCharacteristic(characteristic) {
  return _rxjs.Observable.create(function (o) {
    (0, _logs.log)("ble-verbose", "start monitor " + characteristic.uuid);

    function onCharacteristicValueChanged(event) {
      var characteristic = event.target;
      if (characteristic.value) {
        o.next(Buffer.from(characteristic.value.buffer));
      }
    }

    characteristic.startNotifications().then(function () {
      characteristic.addEventListener("characteristicvaluechanged", onCharacteristicValueChanged);
    });

    return function () {
      (0, _logs.log)("ble-verbose", "end monitor " + characteristic.uuid);
      characteristic.stopNotifications();
    };
  });
};
//# sourceMappingURL=monitorCharacteristic.js.map